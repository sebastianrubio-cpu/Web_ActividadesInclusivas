@model IEnumerable<SistemaWeb.Models.Actividad>

@{
    ViewData["Title"] = "Mapa de Actividades";
}
<style>
/* 1. CONFIGURACIÓN DEL FONDO (PSEUDO-ELEMENTO) */
    body::before {
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1; /* Detrás de todo */
        
        background-image: url('/img/br.jpg');
        background-repeat: no-repeat;
        background-position: center center;
        background-size: cover;
        
        /* MODO CLARO (Por defecto) */
        /* Brillo al 70% para que el texto negro se lea bien, Blur de 8px */
        filter: blur(8px) brightness(0.7);
        
        /* Escala para evitar bordes blancos por el blur */
        transform: scale(1.1); 
        
        /* ANIMACIÓN SUAVE al cambiar de tema */
        transition: filter 0.8s ease; 
    }

    /* 2. MODO OSCURO (Activado por el Layout) */
    [data-theme="dark"]::before {
        /* MODO OSCURO: Bajamos el brillo al 30% */
        filter: blur(8px) brightness(0.3); 
    }

    /* 3. AJUSTES DE TEXTO PARA EL FONDO */
    /* Título con sombra para leerse en cualquier modo */
    .dashboard-title {
        color: var(--uisek-blue); /* Usa el azul del layout */
        text-shadow: 0 0 10px rgba(255,255,255,0.8); /* Resplandor blanco sutil */
    }
    
    [data-theme="dark"] .dashboard-title {
        color: white; /* Blanco en modo oscuro */
        text-shadow: 0 2px 4px rgba(0,0,0,0.5);
    
    }
</style>
<div class="container mt-4">
    <h2>📍 Mapa de Actividades Inclusivas</h2>
    <p>Visualiza la ubicación de todas las actividades registradas en el sistema.</p>

    <div id="map" style="height: 600px; width: 100%; border-radius: 8px; border: 1px solid #ccc;"></div>
</div>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin="" />

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
        crossorigin=""></script>

<script>
// Coordenadas iniciales (Quito)
        var map = L.map('map').setView([-0.1807, -78.4678], 13);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        // --- SOLUCIÓN DE PUNTOS Y COMAS ---
        // Usamos Json.Serialize para pasar los datos de C# a JS de forma segura.
        // Esto evita el problema de la cultura (coma vs punto) automáticamente.
        
        var actividades = @Html.Raw(Json.Serialize(Model.Select(a => new {
            nombre = a.Nombre,
            lat = a.Latitud,
            lng = a.Longitud,
            responsable = a.Responsable,
            cupo = a.Cupo
        })));

        // Recorremos el array de objetos JSON limpio
        actividades.forEach(function(act) {
            // Validamos que las coordenadas no sean 0 (opcional)
            if (act.lat !== 0 && act.lng !== 0) {
                L.marker([act.lat, act.lng])
                 .addTo(map)
                 .bindPopup("<b>" + act.nombre + "</b><br>" + 
                            "Responsable: " + act.responsable + "<br>" +
                            "Cupos: " + act.cupo);
            }
        });
</script>