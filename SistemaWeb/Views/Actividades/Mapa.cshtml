@model IEnumerable<SistemaWeb.Models.Actividad>

@{
    ViewData["Title"] = "Mapa de Actividades";
}
<style>


    body {
        background-color: var(--bg-body);
        background-image: url(/img/br.jpg); /* Asegúrate de que esta imagen exista */
        background-repeat: no-repeat;
        background-position: center center;
        background-size: cover;
        background-attachment: fixed;
        background-blend-mode: multiply;
 
    }

</style>
<div class="container mt-4">
    <h2>📍 Mapa de Actividades Inclusivas</h2>
    <p>Visualiza la ubicación de todas las actividades registradas en el sistema.</p>

    <div id="map" style="height: 600px; width: 100%; border-radius: 8px; border: 1px solid #ccc;"></div>
</div>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin="" />

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
        crossorigin=""></script>

<script>
// Coordenadas iniciales (Quito)
        var map = L.map('map').setView([-0.1807, -78.4678], 13);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        // --- SOLUCIÓN DE PUNTOS Y COMAS ---
        // Usamos Json.Serialize para pasar los datos de C# a JS de forma segura.
        // Esto evita el problema de la cultura (coma vs punto) automáticamente.
        
        var actividades = @Html.Raw(Json.Serialize(Model.Select(a => new {
            nombre = a.Nombre,
            lat = a.Latitud,
            lng = a.Longitud,
            responsable = a.Responsable,
            cupo = a.Cupo
        })));

        // Recorremos el array de objetos JSON limpio
        actividades.forEach(function(act) {
            // Validamos que las coordenadas no sean 0 (opcional)
            if (act.lat !== 0 && act.lng !== 0) {
                L.marker([act.lat, act.lng])
                 .addTo(map)
                 .bindPopup("<b>" + act.nombre + "</b><br>" + 
                            "Responsable: " + act.responsable + "<br>" +
                            "Cupos: " + act.cupo);
            }
        });
</script>