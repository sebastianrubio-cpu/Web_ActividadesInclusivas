@model IEnumerable<SistemaWeb.Models.Usuario>
@{
    ViewData["Title"] = "Gestión de Usuarios";
}

<style>
    /* 1. CONFIGURACIÓN DEL FONDO (PSEUDO-ELEMENTO) */
    body::before {
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1; /* Detrás de todo */

        background-image: url('/img/br.jpg');
        background-repeat: no-repeat;
        background-position: center center;
        background-size: cover;
        /* MODO CLARO (Por defecto) */
        /* Brillo al 70% para que el texto negro se lea bien, Blur de 8px */
        filter: blur(8px) brightness(0.7);
        /* Escala para evitar bordes blancos por el blur */
        transform: scale(1.1);
        /* ANIMACIÓN SUAVE al cambiar de tema */
        transition: filter 0.8s ease;
    }

    /* 2. MODO OSCURO (Activado por el Layout) */
    [data-theme="dark"]::before {
        /* MODO OSCURO: Bajamos el brillo al 30% */
        filter: blur(8px) brightness(0.3);
    }

    /* 3. AJUSTES DE TEXTO PARA EL FONDO */
    /* Título con sombra para leerse en cualquier modo */
    .dashboard-title {
        color: var(--uisek-blue); /* Usa el azul del layout */
        text-shadow: 0 0 10px rgba(255,255,255,0.8); /* Resplandor blanco sutil */
    }

    [data-theme="dark"] .dashboard-title {
        color: white; /* Blanco en modo oscuro */
        text-shadow: 0 2px 4px rgba(0,0,0,0.5);
    }
    /* Colores UISEK para esta vista */
    .uisek-header {
        background-color: #002D72 !important; /* Azul UISEK */
        color: white;
    }

    .btn-uisek {
        background-color: #002D72;
        color: white;
        border: none;
    }

        .btn-uisek:hover {
            background-color: #0040a0;
            color: white;
        }

    /* Adaptación Modo Oscuro */
    [data-theme="dark"] .table {
        color: #e0e0e0;
        border-color: #333;
    }

    [data-theme="dark"] .table-hover tbody tr:hover {
        background-color: rgba(255,255,255,0.05);
    }

    [data-theme="dark"] .fw-bold.text-dark {
        color: #fff !important; /* Corrige nombres negros en modo oscuro */
    }
</style>

<div class="container-fluid px-4 mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="fw-bold mb-0" style="color: var(--uisek-blue);">
                <i class="fas fa-users-cog me-2"></i>Gestión de Usuarios
            </h2>
            <p class="text-muted small mb-0">Administración de docentes y estudiantes</p>
        </div>
        <a asp-action="Crear" class="btn btn-uisek rounded-pill px-4 shadow-sm">
            <i class="fas fa-plus me-2"></i>Nuevo Usuario
        </a>
    </div>

    <div class="card shadow-sm border-0 animate__animated animate__fadeInUp">
        <div class="card-body p-0">
            <table class="table table-hover mb-0 align-middle" id="tablaUsuarios">
                <thead class="uisek-header">
                    <tr>
                        <th class="ps-4 py-3">Cédula</th>
                        <th>Nombre</th>
                        <th>Correo Institucional</th>
                        <th>Rol</th>
                        <th class="text-end pe-4">Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model)
                    {
                        <tr>
                            <td class="ps-4 fw-bold opacity-75">
                                <i class="far fa-id-card me-2"></i>@item.IdUsuario
                            </td>
                            <td>
                                <span class="fw-bold text-dark">@item.Nombre</span>
                            </td>
                            <td>@item.Correo</td>
                            <td>
                                @if (item.Rol == "Administrador")
                                {
                                    <span class="badge bg-danger rounded-pill">Admin</span>
                                }
                                else if (item.Rol == "Profesor")
                                {
                                    <span class="badge bg-info text-dark rounded-pill">Profesor</span>
                                }
                                else
                                {
                                    <span class="badge bg-success rounded-pill">Estudiante</span>
                                }
                            </td>
                            <td class="text-end pe-4">
                                <a asp-action="Editar" asp-route-id="@item.IdUsuario"
                                   class="btn btn-sm btn-outline-primary rounded-circle me-1" title="Editar">
                                    <i class="fas fa-pen"></i>
                                </a>

                                <form asp-action="Eliminar" method="post" class="d-inline" onsubmit="return confirm('¿Seguro que deseas eliminar a @item.Nombre?');">
                                    <input type="hidden" name="id" value="@item.IdUsuario" />
                                    <button type="submit" class="btn btn-sm btn-outline-danger rounded-circle" title="Eliminar">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </form>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>

    <script>
        $(document).ready(function() {
            $('#tablaUsuarios').DataTable({
                "language": { "url": "//cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json" },
                "dom": "<'row m-3'<'col-md-6'f><'col-md-6 text-end'>>" +
                       "<'row'<'col-sm-12'tr>>" +
                       "<'row m-3'<'col-md-5'i><'col-md-7'p>>",
                "columnDefs": [{ "orderable": false, "targets": 4 }]
            });
        });
    </script>
}